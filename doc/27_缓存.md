

## 整合Redis进行缓存

### 引入依赖

```xml
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-redis</artifactId>
        </dependency>
```



### 配置

```yaml
spring:
    host: 192.168.56.10
    port: 6379
```



### 获取三级分类

```java
@Service("categoryService")
public class CategoryServiceImpl extends ServiceImpl<CategoryDao, CategoryEntity> implements CategoryService {

    @Autowired
    StringRedisTemplate redisTemplate;
    
        @Override
    public Map<String, List<Catelog2Vo>> getCatelogJson() {
        String catelogJson = redisTemplate.opsForValue().get("catelogJson");
        if(StringUtils.isEmpty(catelogJson)){
            Map<String, List<Catelog2Vo>> catelogJsonFromDb = getCatelogJsonFromDb();
            String s = JSON.toJSONString(catelogJsonFromDb);
            redisTemplate.opsForValue().set("catelogJson",s);
            return catelogJsonFromDb;
        }
        return JSON.parseObject(catelogJson, new TypeReference<Map<String, List<Catelog2Vo>>>(){});
    }
}

    public Map<String, List<Catelog2Vo>> getCatelogJsonFromDb() {}	// 原获取三级分类方法，内容略
```



### 压测性能

| 压测内容 | 请求路径                                 | 压测线程数 | 吞吐量 | 90%响应时间 | 99%响应时间 |
| -------- | ---------------------------------------- | ---------- | ------ | ----------- | ----------- |
| 三级分类 | http://localhost:9040/index/catelog.json | 50         | 1194.2 | 50          | 74          |

- 压测结果已经录入[25_性能压测](./25_性能压测.md#测试中间件性能) 