

# 商城业务-检索服务

## 搭建页面环境

1. 在`study-mall-search`服务中引入模板引擎

```xml
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-thymeleaf</artifactId>
        </dependency>

```

2. 将搜索页面首页`index.html`放入静态资源文件路径`templates`下
3. 页面引入thymeleaf支持

```html
<html lang="en" xmlns:th="http://www.thymeleaf.org">
```

4. 上传静态资源到Nginx~/html/static/search目录下

   创建目录，`mkdir ~/data/nginx/html/static/search`。上传静态资源

5. 配置域名环境

   使用SwitchHosts软件配置如下规则`192.168.56.10 search.mall.com`

6.  配置Nginx转发

   ```nginx
   server {
       listen       80;
       listen  [::]:80;
       server_name  *.mall.com;
   
       #access_log  /var/log/nginx/host.access.log  main;
   
       location /static/ {
           root   /usr/share/nginx/html;
       }
   
       location / {
           proxy_set_header Host $host; # 转发时携带Host请求头
           proxy_pass http://mall;
   
       }
   
       error_page   500 502 503 504  /50x.html;
       location = /50x.html {
           root   /usr/share/nginx/html;
       }
   }
   ```

   - server_name 修改为`*.mall.com`

7. 修改网关配置，根据host进行转发

   ```yaml
           - id: mall_host_route
             uri: lb://product-service
             predicates:
               - Host=mall.com
   
           - id: search_host_route
             uri: lb://search-service
             predicates:
               - Host=search.mall.com
   ```



## 调整页面跳转

1. 加入热部署依赖，关闭thymeleaf缓存

2. 修改页面内跳转路径，product服务下index.html，search服务下index.html

   注：首页静态文件js/catalogLoader.js，要注意跳转路径修改

3. 修改Nginx配置。mall.com和*.mall.com

```nginx
server {
    listen       80;
    listen  [::]:80;
    server_name  mall.com *.mall.com;

    #access_log  /var/log/nginx/host.access.log  main;

    location /static/ {
        root   /usr/share/nginx/html;
    }

    location / {
        proxy_set_header Host $host; # 转发时携带Host请求头
        proxy_pass http://mall;
    }

    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
```

4. 修改检索服务

   index.html -> list.html

   增加Controller

   ```java
   @Controller
   public class SearchController {
   
       @RequestMapping("list.html")
       public String listPage(){
           return "list";
       }
   }
   ```



## 检索查询参数模型



